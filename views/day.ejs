<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= day %> - AzTV Proqram SiyahÄ±sÄ±</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ“º <%= day.charAt(0).toUpperCase() + day.slice(1) %> Proqram SiyahÄ±sÄ±</h1>
            <a href="/" class="back-link">â† Ana sÉ™hifÉ™yÉ™ qayÄ±t</a>
        </header>

        <div class="day-detail">
            <div class="day-header">
                <h2 id="dayTitle" onclick="editDayTitle('<%= day %>')" title="BaÅŸlÄ±ÄŸÄ± dÉ™yiÅŸmÉ™k Ã¼Ã§Ã¼n kliklÉ™yin">
                    <%= dayData.title %>
                    <span class="edit-icon">âœï¸</span>
                </h2>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="showParseModal()">ğŸ“ Word-dÉ™n YapÄ±ÅŸdÄ±r</button>
                </div>
            </div>

            <div class="day-notes-section">
                <h3>QeydlÉ™r</h3>
                <textarea 
                    class="notes-textarea-large" 
                    placeholder="Bu gÃ¼n Ã¼Ã§Ã¼n qeydlÉ™r..."
                    onblur="saveDayNotes('<%= day %>', this.value)"
                ><%= dayData.notes %></textarea>
            </div>

            <div class="programs-table">
                <div class="table-header">
                    <div class="header-cell">Vaxt</div>
                    <div class="header-cell">Proqram</div>
                    <div class="header-cell">TÉ™svir</div>
                    <div class="header-cell">Kanal</div>
                    <div class="header-cell">ÆmÉ™liyyat</div>
                </div>
                
                <% if (programs && programs.length > 0) { %>
                    <% programs.forEach((program, index) => { %>
                        <div class="table-row">
                            <div class="table-cell time-cell"><%= program.time %></div>
                            <div class="table-cell program-cell"><%= program.program %></div>
                            <div class="table-cell description-cell"><%= program.description || '-' %></div>
                            <div class="table-cell channel-cell"><%= program.channel %></div>
                            <div class="table-cell action-cell">
                                <button class="btn btn-danger btn-sm" onclick="deleteProgram('<%= day %>', <%= index %>)">Sil</button>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="no-programs">
                        <p>Bu gÃ¼n Ã¼Ã§Ã¼n proqram yoxdur</p>
                        <p>Word-dÉ™n kopyaladÄ±ÄŸÄ±nÄ±z mÉ™tnlÉ™ri yapÄ±ÅŸdÄ±rÄ±n</p>
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    <!-- GÃ¼n baÅŸlÄ±ÄŸÄ±nÄ± dÉ™yiÅŸmÉ™ modalÄ± -->
    <div id="editTitleModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>GÃ¼n BaÅŸlÄ±ÄŸÄ±nÄ± DÉ™yiÅŸ</h2>
            <form id="editTitleForm">
                <div class="form-group">
                    <label for="dayTitle">GÃ¼n baÅŸlÄ±ÄŸÄ±:</label>
                    <input type="text" id="dayTitle" name="dayTitle" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Yadda Saxla</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditTitleModal()">LÉ™ÄŸv Et</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Word-dÉ™n yapÄ±ÅŸdÄ±rma modalÄ± -->
    <div id="parseModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Word-dÉ™n Proqram SiyahÄ±sÄ±nÄ± YapÄ±ÅŸdÄ±rÄ±n</h2>
            <p class="modal-description">
                Word-dÉ™n kopyaladÄ±ÄŸÄ±nÄ±z proqram siyahÄ±sÄ±nÄ± aÅŸaÄŸÄ±dakÄ± sahÉ™yÉ™ yapÄ±ÅŸdÄ±rÄ±n. 
                Sistem avtomatik olaraq vaxt vÉ™ proqram adlarÄ±nÄ± tanÄ±yacaq.
            </p>
            <form id="parseForm">
                <div class="form-group">
                    <label for="wordText">Word mÉ™tni:</label>
                    <textarea id="wordText" name="wordText" rows="15" placeholder="MÉ™sÉ™lÉ™n:
*   **07:00:** &quot;TelesÉ™hÉ™r&quot;. Musiqi-informasiya proqramÄ±
*   **10:00:** &quot;HÉ™ftÉ™&quot;. Analitik-informasiya proqramÄ±
*   **12:00:** &quot;AzTV xÉ™bÉ™r&quot;
*   **12:30:** &quot;GÃ¼nÉ™ davam&quot;
..." required></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Parse Et vÉ™ ÆlavÉ™ Et</button>
                    <button type="button" class="btn btn-secondary" onclick="closeParseModal()">LÉ™ÄŸv Et</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Kopyalama bildiriÅŸi -->
    <div id="copyNotification" class="copy-notification">
        <span id="copyMessage">MÉ™tn kopyalandÄ±!</span>
    </div>

    <script>
        const currentDay = '<%= day %>';
        let currentDayTitle = '<%= dayData.title %>';
        
        // GÃ¼n baÅŸlÄ±ÄŸÄ±nÄ± yenilÉ™
        function updateDayTitle() {
            const currentDate = new Date();
            const dateStr = currentDate.toLocaleDateString('az-AZ', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric' 
            });
            
            document.getElementById('dayTitle').innerHTML = `${currentDayTitle} (${dateStr}) <span class="edit-icon">âœï¸</span>`;
        }
        
        // SÉ™hifÉ™ yÃ¼klÉ™ndikdÉ™ gÃ¼n baÅŸlÄ±ÄŸÄ±nÄ± yenilÉ™
        updateDayTitle();
        
        // GÃ¼n baÅŸlÄ±ÄŸÄ±nÄ± dÉ™yiÅŸmÉ™ funksiyalarÄ±
        function editDayTitle(day) {
            const modal = document.getElementById('editTitleModal');
            const titleInput = document.getElementById('dayTitle');
            
            titleInput.value = currentDayTitle;
            modal.style.display = 'block';
            titleInput.focus();
        }
        
        function closeEditTitleModal() {
            const modal = document.getElementById('editTitleModal');
            modal.style.display = 'none';
        }
        
        // GÃ¼n baÅŸlÄ±ÄŸÄ±nÄ± yenilÉ™
        document.getElementById('editTitleForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const newTitle = document.getElementById('dayTitle').value.trim();
            
            if (!newTitle) {
                alert('ZÉ™hmÉ™t olmasa baÅŸlÄ±q daxil edin');
                return;
            }
            
            try {
                const response = await fetch(`/api/day-info/${currentDay}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: newTitle,
                        notes: document.querySelector('.notes-textarea-large').value
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentDayTitle = newTitle;
                    updateDayTitle();
                    closeEditTitleModal();
                    showCopyNotification('BaÅŸlÄ±q yenilÉ™ndi!', 'success');
                } else {
                    alert('XÉ™ta: ' + data.message);
                }
            } catch (error) {
                console.error('XÉ™ta:', error);
                alert('XÉ™ta baÅŸ verdi');
            }
        });
        
        // QeydlÉ™ri yadda saxla
        async function saveDayNotes(day, notes) {
            try {
                const response = await fetch(`/api/day-info/${day}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: currentDayTitle,
                        notes: notes
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showCopyNotification('QeydlÉ™r yadda saxlanÄ±ldÄ±!', 'success');
                }
            } catch (error) {
                console.error('XÉ™ta:', error);
                showCopyNotification('QeydlÉ™r yadda saxlanÄ±lmadÄ±!', 'error');
            }
        }
        
        // Modal funksiyalarÄ±
        function showParseModal() {
            const modal = document.getElementById('parseModal');
            modal.style.display = 'block';
            document.getElementById('wordText').focus();
        }
        
        function closeParseModal() {
            const modal = document.getElementById('parseModal');
            modal.style.display = 'none';
            document.getElementById('wordText').value = '';
        }
        
        // Modal baÄŸlama
        document.addEventListener('DOMContentLoaded', function() {
            const modals = document.querySelectorAll('.modal');
            
            modals.forEach(modal => {
                const closeBtn = modal.querySelector('.close');
                
                if (closeBtn) {
                    closeBtn.onclick = function() {
                        modal.style.display = 'none';
                    }
                }
                
                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = 'none';
                    }
                }
            });
        });
        
        // Word mÉ™tnini parse etmÉ™
        document.getElementById('parseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const wordText = document.getElementById('wordText').value.trim();
            
            if (!wordText) {
                alert('ZÉ™hmÉ™t olmasa mÉ™tn daxil edin');
                return;
            }
            
            try {
                const response = await fetch('/api/parse-text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: wordText,
                        day: currentDay
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    closeParseModal();
                    showCopyNotification(`${data.message}`, 'success');
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else {
                    alert('XÉ™ta: ' + data.message);
                }
            } catch (error) {
                console.error('XÉ™ta:', error);
                alert('XÉ™ta baÅŸ verdi');
            }
        });
        
        async function deleteProgram(day, index) {
            if (confirm('Bu proqramÄ± silmÉ™k istÉ™diyinizÉ™ É™minsiniz?')) {
                try {
                    const response = await fetch(`/api/programs/${day}/${index}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('XÉ™ta baÅŸ verdi');
                    }
                } catch (error) {
                    console.error('XÉ™ta:', error);
                    alert('XÉ™ta baÅŸ verdi');
                }
            }
        }
        

        
        function showCopyNotification(message, type = 'success') {
            const notification = document.getElementById('copyNotification');
            const messageEl = document.getElementById('copyMessage');
            
            messageEl.textContent = message;
            notification.className = `copy-notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
